{% extends 'base.html' %}
{% load static %}

{% block title %}Registro por QR - Plancha{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/administrador/homeAdmin.css' %}">
<link rel="stylesheet" href="{% static 'css/administrador/listados.css' %}">

<script src="https://cdn.jsdelivr.net/npm/jsqr@1.4.0/dist/jsQR.min.js"></script>
{% endblock %}

{% block content %}
  
  <section class="center-area">
    <div id="subtitle">Plancha  - Escanear QR y registrar cantidad</div>
      <div class="contenedor">
        <div class="muted">Apunta con la cámara al QR.</div>
        <section class="video-card">
          <video id="video" autoplay playsinline></video>
          <canvas id="canvas"></canvas>

      <div class="controls">
        <button id="btn-start">Iniciar cámara</button>
        <button id="btn-stop">Detener</button>
        <input id="fileInput" type="file" accept="image/*">
        <select id="format">
          <option value="json">QR contiene JSON</option>
          <option value="plain">Texto plano</option>
        </select>
      </div>

      <div style="margin-top:.75rem">
        <div class="muted">Último QR leído:</div>
        <div id="last" class="scan-result">—</div>
      </div>
    </section>

    <aside class="right">
      <form id="workForm" class="form-card" autocomplete="off">
        <div style="display:flex;gap:.5rem">
          <div style="flex:1">
            <label>Empleado ID</label>
            <input id="employee_id" class="field" name="employee_id" />
          </div>
          <div style="width:120px">
            <label>Fecha / Hora</label>
            <input id="ts" class="field" name="timestamp" />
          </div>
        </div>

        <label>Trabajo / Orden / Tarjeta</label>
        <input id="job_id" class="field" name="job_id" />

        <label>Cantidad realizada</label>
        <input id="quantity" type="number" min="0" step="1" class="field" name="quantity" />

        <label>Comentarios (opcional)</label>
        <input id="notes" class="field" name="notes" />

        <button type="button" id="btn-submit" class="submit">Enviar registro</button>

        <div id="status" style="margin-top:.6rem;font-size:.95rem;color:#374151"></div>
      </form>
    </aside>
  </section>
        
    </div>

    <section id="demo-ajax">
    <h2>Gestión de Comentarios de Máquinas (Demo AJAX)</h2>
    <p>Usa este formulario para probar las peticiones CRUD con Fetch.</p>
    
    <form id="form-comentario">
        <input type="hidden" id="comentario-id" value="">
        <input type="number" id="comentario-maquina" placeholder="ID Máquina" required>
        <input type="number" id="comentario-empleado" placeholder="ID Empleado" required>
        <textarea id="comentario-texto" placeholder="Escribe tu comentario..." required></textarea>
        <button type="submit" id="btn-submit-comentario">Crear Comentario (POST)</button>
        <button type="button" id="btn-reset-form" style="background-color: #6c757d;">Limpiar</button>
    </form>

    <button id="btn-consultar">1. Consultar Todos (GET con .then)</button>
    <button id="btn-dependiente">2. Demo Petición Dependiente (async/await)</button>

    <h3>Comentarios Registrados</h3>
    <ul id="lista-comentarios">
        </ul>
  </section>

  </section>
  
{% endblock %}

{% block regresar %}
<div class="opcion" onclick="location.href='{% url 'home' %}'">Regresar</div>
{% endblock %}